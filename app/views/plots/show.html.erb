<!--Javascript Dependencies for Google Maps API  -->
<script src="//maps.google.com/maps/api/js?key=[your API key]"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->

<p id="notice"><%= notice %></p>
  <div class="container">


  <p>
    <strong>Número:</strong>
    <%= @plot.number %>
  </p>

  <p>
    <strong>Area:</strong>
    <%= @plot.area %>

  </p>

  <p>
    <strong>Hacienda:</strong>
    <%= @plot.ranch %>
  </p>

  <p>
    <strong>Tipo:</strong>
    <%= @plot.plot_type %>
  </p>


  <%= link_to 'Editar', edit_plot_path(@plot) %> |
  <%= link_to 'Atrás', plots_path %> |
    <%= link_to 'Borrar', @plot, method: :delete, data: { confirm: 'Estás seguro?', :title => "Borrar"} %>
</div>

<div class="container">
  <h4>Historial de Evaluaciones</h2>
  <table class="table">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Maleza</th>
        <th>Pasturas</th>
        <th>Cercas</th>
        <th>Promedio</th>
      </tr>
    </thead>

  <tbody>
    <% @plot_evaluations.each do |pe| %>
      <tr>
        <td><%= if pe.date != nil then pe.date.strftime("%d/%m/%y") end %></td>
        <td><%= pe.weed_score %></td>
        <td><%= pe.pasture_score %></td>
        <td><%= pe.fences_score %></td>
        <td><%= ((pe.weed_score + pe.pasture_score + pe.fences_score).to_f / 3).round(2) %></td>
        <td><%= link_to image_tag("info.png", border: 0, title: "Más información"), plot_evaluation_path(pe) %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<div style='width: 800px;'>
  <div id="map" style='width: 800px; height: 400px;'></div>
</div>
<script>

     // This example creates a simple polygon representing the Bermuda Triangle.
     // When the user clicks on the polygon an info window opens, showing
     // information about the polygon's coordinates.

     var map;
     var infoWindow;

     function initMap() {
       map = new google.maps.Map(document.getElementById('map'), {
         zoom: 18,
         center: <%= if @plot.boundaries == "" then "{lat: 15.481249, lng: -86.411314}"  else p @plot.boundaries[0, @plot.boundaries.index('}')] + "}" end %>,

         mapTypeId: 'satellite'
       });

       // Define the LatLng coordinates for the polygon.
       var triangleCoords = [<%= @plot.boundaries %>];

       // Construct the polygon.
       var bermudaTriangle = new google.maps.Polygon({
         paths: triangleCoords,
         strokeColor: '#FF0000',
         strokeOpacity: 0.8,
         strokeWeight: 3,
         fillColor: '#FF0000',
         fillOpacity: 0.35
       });
       bermudaTriangle.setMap(map);

       // Add a listener for the click event.
       bermudaTriangle.addListener('click', showArrays);

       infoWindow = new google.maps.InfoWindow;
     }

     /** @this {google.maps.Polygon} */
     function showArrays(event) {
       // Since this polygon has only one path, we can call getPath() to return the
       // MVCArray of LatLngs.
       var vertices = this.getPath();
       var area  = (google.maps.geometry.spherical.computeArea(vertices) / 6961).toFixed(2);

       var contentString = '<b>Bermuda Triangle polygon</b><br>' +
           'Clicked location: <br>' + event.latLng.lat() + ',' + event.latLng.lng() + ' Area: ' + area + ' Mzs.' +
           '<br>';

       // Iterate over the vertices.
       for (var i =0; i < vertices.getLength(); i++) {
         var xy = vertices.getAt(i);
         contentString += '<br>' + 'Coordinate ' + i + ':<br>' + xy.lat() + ',' +
             xy.lng();
       }

       // Replace the info window's content and position.
       infoWindow.setContent(contentString);
       infoWindow.setPosition(event.latLng);

       infoWindow.open(map);
     }

   </script>
   <script async defer
   src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD958KcviL2p1LIo8_PrFgnP8IQY0bbaN4&callback=initMap">
   </script>
   <strong>Fronteras:</strong>
   <%= @plot.boundaries %>
